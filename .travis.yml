sudo: false
language: c
node_js:
- '8'
matrix:
  include:
    - os: linux
      dist: bionic
      sudo: false
    - os: osx
cache:
  directories:
    - $HOME/.cabal/packages
    - $HOME/.cabal/store
before_cache:
  - rm -fv  $HOME/.cabal/packages/hackage.haskell.org/build-reports.log
  # remove files that are regenerated by 'cabal update'
  - rm -fv  $HOME/.cabal/packages/hackage.haskell.org/00-index.*
  - rm -fv  $HOME/.cabal/packages/hackage.haskell.org/*.json
  - rm -fv  $HOME/.cabal/packages/hackage.haskell.org/01-index.cache
  - rm -fv  $HOME/.cabal/packages/hackage.haskell.org/01-index.tar
  - rm -fv  $HOME/.cabal/packages/hackage.haskell.org/01-index.tar.idx
  - rm -rfv $HOME/.cabal/packages/head.hackage
addons:
  apt:
    update: true
    packages:
    # ghc requirements
    - libgmp-dev
    - libffi-dev
    - libncurses-dev
    - libtinfo5
before-install:
- export BOOTSTRAP_HASKELL_NONINTERACTIVE="true"
- export PATH="${HOME}/.cabal/bin:${HOME}/.ghcup/bin:${HOME}/.local/bin:${PATH}"
- mkdir -p $HOME/.local/bin
install:
- curl --proto '=https' -o ghcup.sh --tlsv1.2 -sSf https://get-ghcup.haskell.org
- sh ghcup.sh
- ghcup install 8.6.5
- cabal install purescript-0.13.6
- npm install -g bower
script:
- cabal build exe:zephyr
- cabal run -f test-with-cabal zephyr-test -- -m generators -m dceEval -m dceExpr -m TestLib
before_deploy:
- bundle/build.sh $TRAVIS_OS_NAME
deploy:
  provider: releases
  api_key:
    secure: QtwaWKRaMpFepbLXokFrLq7dCjOfMVyZvZdZKIj4AChETPpI/5UYwW9VUoiVlSmM9kt+vrCR/ijsn0sLDrT+irE0LXyuZSPxrahZeQgiL5g6EKy1zJhUQQTjXbd8q0zn8fnqkJ5pfDHhwb4JvxYIo3ZyCIS8ipL2fR9YVU4aBHgodzd5jYx9J9IRinDqTmcr2jqHNs19heg5S3Gka5YtwipdfFxDLvnZqNvUUnCaK0Ohis8FEEwr4bCSVLGrvhsht+ceCDAk2wUDrYgYQsIBfixJyoXTRpv36ANEj8ImFbv4HAzXcaP/Z815uuwlAbNH2nhSqX0Ng3tGHpwwut1g2d5K7psHi1J6o++QdTk/I+ep8buKxplnyo5/3b0rh24BC2VIBXDcVpSz+fWvYG/GtBm1fGerqYCr5g5Q5YnXTfY4d0ARBHUmB+F8vK2UfafLROFrDpI2xjrYiQAfS0++FJA5m15EKMEUcI1mXBSEtqmc5mumhWXI6FN4tmc2G644o9Pq2rcrJKt2TjZ/823AOGQZER1OOXatYLB7j6M3v5ZLMI3nYWCGmP51qpdNQjtmmhRcqKqI/9fjA7S9j6pYCRd4V/6KsS8ArNa4G4HOGSM/fMPN/6REREk/a1SlDF++ZIZGoXVj+FgePzsYDptDKTDdulb3UmmnS0J33Jfwm9s=
  file_glob: true
  file:
    - bundle/*.tar.gz
    - bundle/*.sha
  skip_cleanup: true
  overwrite: true
  draft: true
  on:
    tags: true
    repo: coot/zephyr
