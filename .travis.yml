sudo: false
language: c
node_js:
- '8'
matrix:
  include:
    - os: linux
      dist: bionic
      sudo: false
    - os: osx
cache:
  directories:
    - $HOME/.cabal/packages
    - $HOME/.cabal/store
before_cache:
  - rm -fv  $HOME/.cabal/packages/hackage.haskell.org/build-reports.log
  # remove files that are regenerated by 'cabal update'
  - rm -fv  $HOME/.cabal/packages/hackage.haskell.org/00-index.*
  - rm -fv  $HOME/.cabal/packages/hackage.haskell.org/*.json
  - rm -fv  $HOME/.cabal/packages/hackage.haskell.org/01-index.cache
  - rm -fv  $HOME/.cabal/packages/hackage.haskell.org/01-index.tar
  - rm -fv  $HOME/.cabal/packages/hackage.haskell.org/01-index.tar.idx
  - rm -rfv $HOME/.cabal/packages/head.hackage
addons:
  apt:
    update: true
    packages:
    # ghc requirements
    - libgmp-dev
    - libffi-dev
    - libncurses-dev
    - libtinfo5
before-install:
- export BOOTSTRAP_HASKELL_NONINTERACTIVE="true"
- export PATH="${HOME}/.cabal/bin:${HOME}/.ghcup/bin:${HOME}/.local/bin:${PATH}"
- mkdir -p $HOME/.local/bin
install:
- curl --proto '=https' -o ghcup.sh --tlsv1.2 -sSf https://get-ghcup.haskell.org
- sh ghcup.sh
- ghcup install "8.6.5"
- ghcup set "8.6.5"
- ghcup list
- ghc --version
  cabal update
- cabal install purescript-0.13.8
- npm install -g bower
script:
- cp cabal.project.ci cabal.project.local
- cabal build exe:zephyr
- cabal build zephyr-test
- cabal run zephyr-test -- -m generators -m dceEval -m dceExpr -m TestLib
before_deploy:
- bundle/build.sh $TRAVIS_OS_NAME
deploy:
  provider: releases
  api_key:
    secure: Yo9E4uBAgSAtsAj4CZ+hraiYdSbbeavNfcfcdUxapvB/fAsCs9sD2iNbqHfGwYppJKvnrYJZo62UsMskodSuqLhFnn6VH5k38N1xC3LY0VFQNvDwj4qf6WZ7Mig3m25xVElVmO7IVRRwThq837c10n8GOxvmfxMp+VDI5E7j3qkCLmtKAB0swtTWRQsRRiW0AqKZeAhZ8HINCNNwF65Q7/Vw1Gcm17J0ABh+pTVfJ+tO595JsA6W5+PrVnlcKDM+fuwT+EQ1BxhxKJORV+0lnDKG8KZ8PFkEF9xPW+erOXwTpA1E8SdnU5bucdOP128WR1Gy707pmoR4W16Nwo0fVC2yzxMxTKqdyqPCLBk4o09UYmp7urdplHVg8XXE2ulYqpkK7MQ47TpOJBwGA1zqQoyVJG4QgrPhyj1f1AxLVLXPIgB8MeoMO0nIShLkCJwTHAgTW8ca++TlSXvk/UuW9sbRBSwZJYqbUH2a4OTx3bDDjfhuhGU1nwCUlGA4TbQ/T6ae1uN3tjhUN1Z1RJCWi5u03ptwRu0yyWTmDzcUYAQn7X3cV5sXcPQTHJE6tV5c0SAfkEMI+lEFIRoE5I0SaeEHJN7Ez+AlA4eUnOxBCRed/90MqXLI9aLZMtNvpfnLJoaki5IThxgdrvHmj38eAOgPiBhD0a2HMZKuWNpqhZI=
  file_glob: true
  file:
    - bundle/*.tar.gz
    - bundle/*.sha
  skip_cleanup: true
  overwrite: true
  draft: true
  on:
    all_branches: true
    tags: true
    repo: coot/zephyr
